# https://github.com/razorcd/mlops-training/blob/a6abe78f93f045886b487443bd21e8991d08f527/capstone-project/docker-compose-model-registry.yml

version: '3.7'

services:
    mlflow_server:
      restart: always
      build:
        context: ./mlflow
        dockerfile: Dockerfile-mlflow
      image: mlflow_server
      container_name: 
      ports:
        - 5051:5050
      networks:
        - backend
      volumes:
        - /tmp/mlopsdb:/tmp/mlopsdb
        - /tmp/mlopsartifacts:/tmp/mlopsartifacts
        - /tmp/store:/tmp/store

    localstack:
      container_name: localstack_main
      image: localstack/localstack
      hostname: aws
      ports:
        - "4566:4566"            # LocalStack Gateway
        - "4510-4559:4510-4559"  # external services port range
      environment:
        - SERVICES=s3,kinesis
        - AWS_DEFAULT_REGION=eu-west-1
        - AWS_ACCESS_KEY_ID=ID1
        - LOCALSTACK_HOSTNAME=aws
      networks:
        - backend  
        - external

networks:
    backend:
        driver: bridge
    external:
        driver: bridge